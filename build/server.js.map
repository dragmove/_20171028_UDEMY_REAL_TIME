{"version":3,"sources":["webpack:///webpack/bootstrap 5bd596d99b9934c3d9ab","webpack:///external \"rxjs\"","webpack:///./src/shared/observable-socket.js","webpack:///./src/server/lib/module.js","webpack:///external \"lodash\"","webpack:///./src/shared/validator.js","webpack:///external \"webpack\"","webpack:///./src/server/server.js","webpack:///external \"source-map-support/register\"","webpack:///external \"express\"","webpack:///external \"http\"","webpack:///external \"socket.io\"","webpack:///external \"chalk\"","webpack:///./src/shared/operators.js","webpack:///./src/server/modules/users.js","webpack:///./src/shared/validation/users.js","webpack:///./src/server/modules/playlist.js","webpack:///./src/server/modules/chat.js","webpack:///./src/shared/validation/chat.js","webpack:///external \"webpack-dev-middleware\"","webpack:///external \"webpack-hot-middleware\"","webpack:///./webpack.client.config.js","webpack:///external \"path\"","webpack:///external \"extract-text-webpack-plugin\""],"names":["clientMessage","fail","success","message","error","Error","throw","successObservable","empty","ObservableSocket","_state","isConnected","isReconnecting","socket","_socket","_actionCallbacks","_requests","_nextRequestId","status$","merge","on$","map","attempt","publishReplay","refCount","subscribe","state","event","fromEvent","callback","on","off","arg","emit","action","id","console","log","_registerCallbacks","subject","hasOwnProperty","request","_popRequest","next","complete","requestId","value","hasValue","item","_emitError","stack","actions","onAction","ModuleBase","client","Validator","_errors","length","join","push","isValid","errors","isDevelopment","process","env","NODE_ENV","app","server","Server","io","USE_WEBPACK","webpackMiddleware","require","webpackHotMiddleware","webpack","clientConfig","compiler","use","publicPath","stats","colors","chunks","assets","timings","modules","hash","version","bgRed","set","static","useExternalStyles","get","req","res","render","videoServices","playlistRepository","users","chat","playlist","connection","remoteAddress","mod","registerClient","clientRegistered","port","startServer","listen","m","init$","err","prototype","safeSubscribe","subscription","e","unsubscribe","catchWrap","catch","of","AuthContext","Symbol","UsersModule","_io","_userList","_users","username","reduce","ch","charCodeAt","Math","abs","hue","saturation","lightness","auth","isLoggedIn","trim","validator","throw$","name","color","getColorForUsername","getUserForClient","index","indexOf","splice","onActions","loginClient$","logoutClient","validateLogin","USERNAME_REGEX","test","PlaylistModule","usersModule","_repository","_services","MAX_HISTORY","BATCH_SIZE","ChatModule","_chatLog","user","type","newMessage","time","Date","getTime","sendMessage","validateSendMessage","MESSAGE_TYPES","includes","path","ExtractTextPlugin","dirname","resolve","vendorModules","createConfig","isDebug","devTool","plugins","optimize","CommonsChunkPlugin","filename","cssLoader","loader","sassLoader","appEntry","UglifyJsPlugin","sourceMap","extract","fallback","HotModuleReplacementPlugin","devtool","entry","application","vendor","output","alias","shared","module","rules","exclude","exports"],"mappings":"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","file":"server.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 6);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 5bd596d99b9934c3d9ab","module.exports = require(\"rxjs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"rxjs\"\n// module id = 0\n// module chunks = 0","import {Observable, ReplaySubject} from 'rxjs';\n\nexport function clientMessage(message) {\n  const error = new Error(message);\n  error.clientMessage = message;\n\n  return error;\n}\n\nexport function fail(message) {\n  return Observable.throw({clientMessage: message});\n}\n\nlet successObservable = Observable.empty();\nexport function success() {\n  return successObservable;\n}\n\nexport class ObservableSocket {\n  get isConnected() {\n    return this._state.isConnected;\n  }\n\n  get isReconnecting() {\n    return this._state.isReconnecting;\n  }\n\n  get isTotallyDead() {\n    return !this.isConnected && !this.isReconnecting;\n  }\n\n  constructor(socket) {\n    this._socket = socket;\n\n    this._state = {};\n\n    this._actionCallbacks = {};\n\n    this._requests = {};\n\n    this._nextRequestId = 0;\n\n    this.status$ = Observable.merge(\n      this.on$('connect').map(() => ({isConnected: true})),\n      this.on$('disconnect').map(() => ({isConnected: false})),\n      this.on$('reconnecting').map(attempt => ({isConnected: false, isReconnecting: true, attempt})),\n      this.on$('reconnect_failed').map(() => ({isConnected: false, isReconnecting: false})))\n      .publishReplay(1)\n      .refCount();\n\n    this.status$.subscribe(state => this._state = state);\n  }\n\n  // basic wrappers\n  on$(event) {\n    return Observable.fromEvent(this._socket, event);\n  }\n\n  on(event, callback) {\n    this._socket.on(event, callback);\n  }\n\n  off(event, callback) {\n    this._socket.off(event, callback);\n  }\n\n  emit(event, arg) {\n    this._socket.emit(event, arg);\n  }\n\n  // emit (client side)\n  emitAction$(action, arg) {\n    const id = this._nextRequestId++;\n\n    console.log('client side. action, arg :', action, arg);\n\n    this._registerCallbacks(action);\n\n    const subject = this._requests[id] = new ReplaySubject(1);\n\n    // emit event to server side\n    this._socket.emit(action, arg, id);\n\n    return subject;\n  }\n\n  _registerCallbacks(action) {\n    // login(username) -> emit('login') -> server -> emit('login', {data}) -> client\n\n    // client.emit('login', {args}, requestId);\n\n    if (this._actionCallbacks.hasOwnProperty(action)) return;\n\n    // get event from server side\n    this._socket.on(action, (arg, id) => {\n      const request = this._popRequest(id);\n      if (!request) return;\n\n      console.log('request :', request);\n\n      request.next(arg);\n      request.complete();\n    });\n\n    this._socket.on(`${action}:fail`, (arg, id) => {\n      const request = this._popRequest(id);\n      if (!request) return;\n\n      request.error(arg);\n    });\n\n    this._actionCallbacks[action] = true;\n  }\n\n  _popRequest(id) {\n    if (!this._requests.hasOwnProperty(id)) {\n      console.error(`Event with id ${id} was returned twice, or the server did not send back an id`);\n      return;\n    }\n\n    const request = this._requests[id];\n\n    delete this._requests[id];\n\n    return request;\n  }\n\n  // on (server side)\n  onAction(action, callback) {\n\n    // get event from client side\n    this._socket.on(action, (arg, requestId) => {\n      console.log('action :', action);\n      console.log('arg :', arg);\n      console.log('requestId :', requestId);\n\n      try {\n        const value = callback(arg);\n\n        if(!value) {\n          this._socket.emit(action, null, requestId);\n          return;\n        }\n\n        if(typeof(value.subscribe) !== 'function') {\n          console.log('value.subscribe from server side :', value.subscribe);\n          \n          this._socket.emit(action, value, requestId);\n          return;\n        }\n\n        let hasValue = false;\n        value.subscribe({\n          next: (item) => {\n            console.log('next item :', item);\n\n            if(hasValue) {\n              throw new Error(`Action ${action} produced more than one value.`);\n            }\n\n            this._socket.emit(action, item, requestId);\n\n            hasValue = true;\n          },\n\n          error: (error) => {\n            this._emitError(action, requestId, error);\n\n            console.error(error.stack || error);\n          },\n\n          complete: () => {\n            console.log('complete from server side');\n\n            if(!hasValue) {\n              this._socket.emit(action, null, requestId);\n            }\n          }\n        });\n\n      } catch (error) {\n        if (typeof(requestId) !== 'undefined') {\n          this._emitError(action, requestId, error);\n        }\n\n        console.error(error.stack || error);\n      }\n    });\n  }\n\n  onActions(actions) {\n    for (let action in actions) {\n      if(!actions.hasOwnProperty(action)) continue;\n\n      this.onAction(action, actions[action]);\n    }\n  }\n\n  _emitError(action, id, error) {\n    console.log('_emitError action, id, error :', action, id, error);\n\n    const message = (error & error.clientMessage) || 'Fatal Error';\n    this._socket.emit(`${action}:fail`, {message}, id);\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/shared/observable-socket.js","import {Observable} from 'rxjs';\n\n/*eslint no-unused-vars: \"off\"*/\n\nexport class ModuleBase {\n  init$() {\n    return Observable.empty();\n  }\n\n  registerClient(client) {\n    //\n  }\n\n  clientRegistered(client) {\n    //\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/server/lib/module.js","module.exports = require(\"lodash\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash\"\n// module id = 3\n// module chunks = 0","import {Observable} from 'rxjs';\n\nexport class Validator {\n  get isValid() {\n    return !this._errors.length;\n  }\n\n  get errors() {\n    return this._errors;\n  }\n\n  get message() {\n    return this._errors.join(', ');\n  }\n\n  get hasErrors() {\n    return this._errors.length > 0;\n  }\n\n  constructor() {\n    this._errors = [];\n  }\n\n  error(message) {\n    this._errors.push(message);\n  }\n\n  toObject() {\n    if (this.isValid) return {};\n\n    return {\n      errors: this._errors,\n      message: this.message\n    };\n  }\n\n  throw$() {\n    console.log('validator.js throw$: this.message :', this.message);\n    return Observable.throw({clientMessage: this.message});\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/shared/validator.js","module.exports = require(\"webpack\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"webpack\"\n// module id = 5\n// module chunks = 0","import 'source-map-support/register';\n\nimport express from 'express';\nimport http from 'http';\nimport socketIo from 'socket.io';\nimport chalk from 'chalk';\nimport {Observable} from 'rxjs';\n\nimport 'shared/operators';\nimport {ObservableSocket} from 'shared/observable-socket';\n\nimport {UsersModule} from './modules/users';\nimport {PlaylistModule} from './modules/playlist';\nimport {ChatModule} from './modules/chat';\n\nconst isDevelopment = process.env.NODE_ENV !== 'production';\n\n/*\n * socket\n */\nconst app = express();\nconst server = new http.Server(app);\nconst io = socketIo(server);\n\n/*\n * client webpack\n */\nif (process.env.USE_WEBPACK === 'true') {\n  var webpackMiddleware = require('webpack-dev-middleware'),\n    webpackHotMiddleware = require('webpack-hot-middleware'),\n    webpack = require('webpack'),\n    clientConfig = require('../../webpack.client.config');\n\n  const compiler = webpack(clientConfig(true));\n\n  app.use(webpackMiddleware(compiler, {\n    publicPath: '/build/',\n    stats: {\n      colors: true,\n      chunks: false,\n      assets: false,\n      timings: false,\n      modules: false,\n      hash: false,\n      version: false\n    }\n  }));\n\n  app.use(webpackHotMiddleware(compiler));\n\n  console.log(chalk.bgRed('Using Webpack Dev MiddleWare. this is for dev only.'));\n}\n\n/*\n * configure Express\n */\napp.set('view engine', 'pug');\n\napp.use(express.static('public'));\n\nconst useExternalStyles = !isDevelopment;\n\napp.get('/', (req, res) => {\n  res.render('index', {\n    useExternalStyles\n  });\n});\n\n/*\n * services\n */\nconst videoServices = [];\nconst playlistRepository = {};\n\n\n/*\n * modules\n */\nconst users = new UsersModule(io);\nconst chat = new ChatModule(io, users);\nconst playlist = new PlaylistModule(io, users, playlistRepository, videoServices);\n\nconst modules = [users, chat, playlist];\n\n\n/*\n * socket\n */\nio.on('connection', socket => {\n  console.log(`Got connection from ${socket.request.connection.remoteAddress}`);\n\n  const client = new ObservableSocket(socket);\n\n  for (let mod of modules) {\n    mod.registerClient(client);\n  }\n\n  for (let mod of modules) {\n    mod.clientRegistered(client);\n  }\n\n  /*\n   client.onAction('login', creds => {\n   // throw clientMessage('user not logged in');\n   // return {user: creds.username};\n   // return Observable.of(`user: ${creds.username}`).delay(3000);\n   throw new Error('whoa');\n   });\n   */\n});\n\n/*\n * start up\n */\nconst port = process.env.port || 3000;\n\nfunction startServer() {\n  server.listen(port, () => {\n    console.log(`Started http server on ${port}`);\n  });\n}\n\nObservable.merge(...modules.map(m => m.init$()))\n  .subscribe({\n    complete() {\n      startServer();\n    },\n\n    error(err) {\n      console.error(`Could not init module: ${err.stack || err}`);\n    }\n  });\n\n// startServer();\n\n\n// WEBPACK FOOTER //\n// ./src/server/server.js","module.exports = require(\"source-map-support/register\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"source-map-support/register\"\n// module id = 7\n// module chunks = 0","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"http\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"http\"\n// module id = 9\n// module chunks = 0","module.exports = require(\"socket.io\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"socket.io\"\n// module id = 10\n// module chunks = 0","module.exports = require(\"chalk\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"chalk\"\n// module id = 11\n// module chunks = 0","import {Observable} from 'rxjs';\n\nObservable.prototype.safeSubscribe = function (next, error, complete) {\n  const subscription = this.subscribe((item) => {\n    try {\n      next(item);\n\n    } catch (e) {\n      console.log(e.stack || e);\n      subscription.unsubscribe();\n    }\n  }, error, complete);\n\n  return subscription;\n};\n\nObservable.prototype.catchWrap = function() {\n  return this.catch(error => Observable.of({error: error}));\n};\n\n\n// WEBPACK FOOTER //\n// ./src/shared/operators.js","import _ from 'lodash';\nimport {Observable} from 'rxjs';\n\nimport {ModuleBase} from '../lib/module';\nimport {validateLogin} from 'shared/validation/users';\nimport {fail} from 'shared/observable-socket';\n\nconst AuthContext = Symbol('AuthContext');\n\nexport class UsersModule extends ModuleBase {\n  constructor(io) {\n    super();\n\n    this._io = io;\n\n    this._userList = [];\n\n    this._users = {};\n\n    /*\n     this._userList = [\n     {name: 'Foo', color: this.getColorForUsername('Foo')},\n     {name: 'Bar', color: this.getColorForUsername('Bar')},\n     {name: 'Baz', color: this.getColorForUsername('Baz')}\n     ];\n     */\n  }\n\n  getColorForUsername(username) {\n    let hash = _.reduce(username, (hash, ch) => ch.charCodeAt(0) + (hash << 6) + (hash << 16) - hash, 0);\n\n    hash = Math.abs(hash);\n\n    // these values are arbitrary.\n    const hue = hash % 360,\n      saturation = hash % 25 + 70,\n      lightness = 100 - (hash % 15 + 35);\n\n    return `hsl(${hue}, ${saturation}%, ${lightness}%)`;\n  }\n\n  getUserForClient(client) {\n    const auth = client[AuthContext];\n\n    if(!auth) return null;\n\n    return (auth.isLoggedIn) ? auth : null;\n  }\n\n  loginClient$(client, username) {\n    username = username.trim();\n\n    const validator = validateLogin(username);\n\n    if (!validator.isValid) {\n\n      return validator.throw$();\n    } // Observable.throw({clientMessage: validator.message});\n\n\n    if (this._users.hasOwnProperty(username)) {\n      // return Observable.throw({clientMessage: '12345'});\n\n      // TODO - confirm print this\n      return fail(`Username ${username} is already taken`);\n    }\n\n    const auth = client[AuthContext] || (client[AuthContext] = {});\n    if (auth.isLoggedIn) {\n      // TODO - confirm print this\n      return fail('You are already logged in');\n    }\n\n    auth.name = username;\n    auth.color = this.getColorForUsername(username);\n    auth.isLoggedIn = true;\n\n    this._users[username] = client;\n    this._userList.push(auth);\n\n    this._io.emit('users:added', auth);\n    console.log(`User ${username}`);\n\n    return Observable.of(auth);\n  }\n\n  logoutClient(client) {\n    const auth = this.getUserForClient(client);\n\n    if(!auth) return;\n\n    const index = this._userList.indexOf(auth);\n    this._userList.splice(index, 1);\n\n    delete this._users[auth.name];\n    delete client[AuthContext];\n    \n    this._io.emit('users:removed', auth);\n\n    console.log(`User ${auth.name} logged out`);\n  }\n\n  registerClient(client) {\n    // client is an instance of ObservableSocket\n\n    /*\n     // test code\n     let index = 0;\n     setInterval(() => {\n     const username = `New user ${index}`;\n     const user = {name: username, color: this.getColorForUsername(username)};\n\n     client.emit('users:added', user);\n\n     index++;\n     }, 5000);\n     */\n\n    client.onActions({\n      'users:list': () => {\n        return this._userList;\n      },\n\n      'auth:login': ({name}) => {\n        return this.loginClient$(client, name);\n      },\n\n      'auth:logout': () => {\n        this.logoutClient(client);\n      }\n    });\n\n    client.on('disconnect', () => {\n      this.logoutClient(client);\n    });\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/server/modules/users.js","import {Validator} from '../validator';\n\nexport let USERNAME_REGEX = /^[\\w\\d_-]+$/;\n\nexport function validateLogin(username) {\n  const validator = new Validator();\n\n  if (username.length >= 20) {\n    validator.error('Username must be fewer than 20 characters');\n  }\n\n  if (!USERNAME_REGEX.test(username)) {\n    validator.error('username can only contain numbers, digits, underscore and dashes');\n  }\n\n  return validator;\n}\n\n\n// WEBPACK FOOTER //\n// ./src/shared/validation/users.js","import {ModuleBase} from '../lib/module';\n\nexport class PlaylistModule extends ModuleBase {\n  constructor(io, usersModule, playlistRepository, videoServices) {\n    super();\n\n    this._io = io;\n    this._users = usersModule;\n    this._repository = playlistRepository;\n    this._services = videoServices;\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/server/modules/playlist.js","import {ModuleBase} from '../lib/module';\n\nimport {validateSendMessage} from 'shared/validation/chat';\nimport {fail} from 'shared/observable-socket';\n\nconst MAX_HISTORY = 100;\nconst BATCH_SIZE = 10;\n\nexport class ChatModule extends ModuleBase {\n  constructor(io, usersModule) {\n    super();\n\n    this._io = io;\n    this._users = usersModule;\n\n    this._chatLog = [];\n  }\n\n  sendMessage(user, message, type) {\n    message = message.trim();\n\n    const validator = validateSendMessage(user, message, type);\n    if (!validator.isValid) {\n      return validator.throw$();\n    }\n\n    const newMessage = {\n      user: {name: user.name, color: user.color},\n      message: message,\n      time: new Date().getTime(),\n      type: type\n    };\n\n    this._chatLog.push(newMessage);\n\n    if (this._chatLog.length >= MAX_HISTORY) {\n      this._chatLog.splice(0, BATCH_SIZE);\n    }\n\n    this._io.emit('chat:added', newMessage);\n  }\n\n  registerClient(client) {\n    client.onActions({\n\n      'chat:list': () => {\n        return this._chatLog;\n      },\n\n      'chat:add': ({message, type}) => {\n        type = type || 'normal';\n\n        const user = this._users.getUserForClient(client);\n        if (!user) {\n          return fail('You must be logged in');\n        }\n\n        this.sendMessage(user, message, type);\n      }\n    })\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/server/modules/chat.js","import _ from 'lodash';\nimport {Validator} from '../validator';\n\nexport let MESSAGE_TYPES = ['normal'];\n\nexport function validateSendMessage(user, message, type) {\n  const validator = new Validator();\n\n  if (message.length > 50) {\n    validator.error('Message must be smaller than 50 characters');\n  }\n\n  if (message.trim().length === 0) {\n    validator.error('Message cannot be empty');\n  }\n\n  if (!_.includes(MESSAGE_TYPES, message)) {\n    validator.error(`Invalid message type ${type}`);\n  }\n\n  return validator;\n}\n\n\n// WEBPACK FOOTER //\n// ./src/shared/validation/chat.js","module.exports = require(\"webpack-dev-middleware\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"webpack-dev-middleware\"\n// module id = 18\n// module chunks = 0","module.exports = require(\"webpack-hot-middleware\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"webpack-hot-middleware\"\n// module id = 19\n// module chunks = 0","var path = require('path'),\n  webpack = require('webpack'),\n  ExtractTextPlugin = require('extract-text-webpack-plugin'),\n  dirname = path.resolve('./');\n\nconst vendorModules = ['jquery', 'lodash', 'socket.io-client', 'rxjs'];\n\nfunction createConfig(isDebug) {\n  const devTool = (isDebug) ? 'eval-source-map' : 'source-map';\n\n  const plugins = [new webpack.optimize.CommonsChunkPlugin({\n    name: 'vendor',\n    filename: 'vendor.js'\n  })];\n\n  let cssLoader = {\n    test: /\\.css$/,\n    use: [\n      {loader: \"style-loader\"},\n      {loader: \"css-loader\"},\n    ]\n  };\n\n  let sassLoader = {\n    test: /\\.scss$/,\n    use: [\n      {loader: \"style-loader\"},\n      {loader: \"css-loader\"},\n      {loader: \"sass-loader\"},\n    ]\n  };\n\n  const appEntry = ['./src/client/application.js'];\n\n  if(!isDebug) {\n    plugins.push(new webpack.optimize.UglifyJsPlugin({\n      sourceMap: true\n    }));\n\n    plugins.push(new ExtractTextPlugin('[name].css'));\n\n    // cssLoader.loader = ExtractTextPlugin.extract('style', 'css');\n    cssLoader = {\n      test: /\\.css$/,\n\n      use: ExtractTextPlugin.extract({\n        fallback: 'style-loader',\n        use: ['css-loader']\n      })\n    };\n\n    // sassLoader.loader = ExtractTextPlugin.extract('style', 'css!sass');\n    sassLoader = {\n      test: /\\.scss$/,\n\n      use: ExtractTextPlugin.extract({\n        fallback: 'style-loader',\n        use: ['css-loader', 'sass-loader']\n      })\n    };\n\n  } else {\n    plugins.push(new webpack.HotModuleReplacementPlugin());\n\n    appEntry.splice(0, 0, 'webpack-hot-middleware/client');\n  }\n\n  return {\n    devtool: devTool,\n    entry: {\n      application: appEntry,\n      vendor: vendorModules\n    },\n    output: {\n      filename: '[name].js',\n      path: path.join(dirname, 'public', 'build'),\n      publicPath: '/build/'\n    },\n    resolve: {\n      alias: {\n        shared: path.join(dirname, 'src', 'shared')\n      }\n    },\n    module: {\n      rules: [\n        {\n          test: /\\.js$/,\n          exclude: /node_modules/,\n          loader: 'babel-loader'\n        },\n\n        {\n          test: /\\.js$/,\n          exclude: /node_modules/,\n          loader: 'eslint-loader',\n        },\n\n        {\n          test: /\\.(gif|png|jpg|jpeg)$/,\n          use: [{\n            loader: 'file-loader'\n          }]\n        },\n\n        {\n          test: /\\.(woff|woff2|ttf|eot|svg)$/,\n          use: [{\n            loader: 'url-loader'\n          }]\n        },\n\n        cssLoader,\n\n        sassLoader\n      ]\n    },\n    plugins: plugins\n  };\n}\n\nmodule.exports = createConfig;\n\n\n// WEBPACK FOOTER //\n// ./webpack.client.config.js","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 21\n// module chunks = 0","module.exports = require(\"extract-text-webpack-plugin\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"extract-text-webpack-plugin\"\n// module id = 22\n// module chunks = 0"],"sourceRoot":""}